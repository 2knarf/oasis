#!/bin/rc

flag e +

repo=$1
out=$2
mode=$3
name=$4
shift 4

fn checkstatus {}

hash=`{
	switch($mode) {
	case 12????
		printf %s $1 | git -C $repo hash-object -w --stdin
	case 10????
		git -C $repo hash-object -w --stdin <$1
	case *
		status=1
	}
}
checkstatus

printf '%s %s\t%s\n' $mode $hash $name >$out.tmp
mv $out.tmp $out
