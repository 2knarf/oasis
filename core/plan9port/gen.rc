cflags\
	-I '$srcdir'/src/include\
	-I '$srcdir'/src/src/cmd/rc\
	-I '$srcdir'/src/src/lib9/fmt\
	-I '$outdir'

yacc x '$srcdir'/src/src/cmd/rc/syn.y

static_lib lib9.a src/lib9/^(\
	argv0.c\
	atexit.c\
	atoi.c\
	await.c\
	create.c\
	dirfstat.c\
	dirread.c\
	dirstat.c\
	dup.c\
	errstr.c\
	fmt/dofmt.c\
	fmt/fltfmt.c\
	fmt/fmt.c\
	fmt/fmtfd.c\
	fmt/fmtfdflush.c\
	fmt/fmtlocale.c\
	fmt/fmtstr.c\
	fmt/fprint.c\
	fmtlock2.c\
	fmt/nan64.c\
	fmt/runefmtstr.c\
	fmt/smprint.c\
	fmt/snprint.c\
	fmt/sprint.c\
	fmt/strtod.c\
	fmt/vfprint.c\
	fmt/vseprint.c\
	fmt/vsmprint.c\
	fmt/vsnprint.c\
	get9root.c\
	getcallerpc-x86_64.c\
	getenv.c\
	jmp.c\
	main.c\
	malloc.c\
	mallocz.c\
	notify.c\
	open.c\
	_p9dir.c\
	pipe.c\
	postnote.c\
	qlock.c\
	readn.c\
	rfork.c\
	seek.c\
	strdup.c\
	strecpy.c\
	sysfatal.c\
	tokenize.c\
	unsharp.c\
	utf/rune.c\
	utf/utflen.c\
	utf/utfnlen.c\
	utf/utfrune.c\
	wait.c\
	write.c\
)

srcs=(\
	code.c\
	exec.c\
	getflags.c\
	glob.c\
	here.c\
	io.c\
	lex.c\
	pcmd.c\
	pfnc.c\
	simple.c\
	subr.c\
	trap.c\
	tree.c\
	unixcrap.c\
	var.c\
	plan9ish.c\
	havefork.c\
) {
	for(src in $srcs) cc src/cmd/rc/$src '||' '$outdir/stamp'
	cc '$outdir'/x.tab.c
	link rc src/cmd/rc/$srcs.o x.tab.c.o lib9.a
}

file bin/rc '$outdir'/rc 755
file share/man/man1/rc.1 '$srcdir'/src/man/man1/rc.1 644
file lib/rcmain '$srcdir'/src/rcmain 644

stamp x.tab.h
